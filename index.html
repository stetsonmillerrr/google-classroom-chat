<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Supabase Chat Test</title>
<style>
  body { font-family: sans-serif; background: #222; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
  input, button { margin: 5px; padding: 10px; border-radius: 5px; border: none; }
  #msg { color: #f55; margin-top: 10px; }
</style>
</head>
<body>

<h2>Sign Up Test</h2>
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button id="signupBtn">Sign Up</button>
<div id="msg"></div>

<!-- Supabase UMD -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
<script>
  const SUPABASE_URL = 'https://abzuknojmeonakneokkp.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_CZM5pIi5X5wGCogqjoHZ9g_9O_XW-ad';
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');
  const signupBtn = document.getElementById('signupBtn');
  const msgDiv = document.getElementById('msg');

  signupBtn.addEventListener('click', async () => {
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();
    msgDiv.textContent = '';

    if (!username || !password) {
      msgDiv.textContent = 'Enter username and password!';
      return;
    }

    console.log('Sign Up clicked:', username);

    try {
      // Check if username exists
      const { data: existing, error: selectError } = await supabase
        .from('users')
        .select()
        .eq('username', username);

      if (selectError) throw selectError;
      if (existing.length) {
        msgDiv.textContent = 'Username already taken!';
        return;
      }

      // Insert new user
      const { data, error } = await supabase
        .from('users')
        .insert([{ username, password, status: 'online' }])
        .select();

      if (error) throw error;

      console.log('User created:', data[0]);
      msgDiv.style.color = '#0f0';
      msgDiv.textContent = 'Sign Up successful! User ID: ' + data[0].id;

    } catch (err) {
      console.error('Sign Up error:', err);
      msgDiv.textContent = 'Error: ' + err.message;
    }
  });
</script>
</body>
</html>
