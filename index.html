<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classroom Chat Debug</title>
<style>
body { font-family:"Segoe UI",sans-serif; background:#2f3136; color:#fff; margin:0; display:flex; justify-content:center; align-items:center; height:100vh; transition:0.3s; }
body.light { background:#f2f3f5; color:#111; }
.chat-container { width:900px; max-width:95%; background:#36393f; border-radius:12px; display:flex; flex-direction:column; overflow:hidden; box-shadow:0 0 20px rgba(0,0,0,0.5); transition:0.3s; }
input,button,select { border-radius:6px; border:none; outline:none; font-size:14px; transition:0.2s; }
input[type="text"], input[type="password"] { flex:1; padding:10px; margin-right:10px; background:#40444b; color:#fff; }
button { background:#7289da; color:#fff; padding:10px 15px; cursor:pointer; }
button:hover { background:#5b6eae; }
#authMsg { color:#f55; margin-top:5px; }
</style>
</head>
<body>
<div class="chat-container">
  <div id="authBox">
    <h2>Sign Up / Login</h2>
    <input type="text" id="regUsername" placeholder="Username">
    <input type="password" id="regPassword" placeholder="Password">
    <button id="signupBtn">Sign Up</button>
    <button id="loginBtn">Login</button>
    <div id="authMsg"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const SUPABASE_URL = 'https://abzuknojmeonakneokkp.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_CZM5pIi5X5wGCogqjoHZ9g_9O_XW-ad';
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  console.log("Supabase loaded:", supabase);

  const authMsg = document.getElementById('authMsg');
  const regUsername = document.getElementById('regUsername');
  const regPassword = document.getElementById('regPassword');
  const signupBtn = document.getElementById('signupBtn');
  const loginBtn = document.getElementById('loginBtn');

  // Debug helper
  function logError(msg, err) {
    console.error(msg, err);
    authMsg.textContent = msg + (err ? ' | ' + err.message : '');
  }

  signupBtn.addEventListener('click', async () => {
    console.log("Sign Up clicked");
    const username = regUsername.value.trim();
    const password = regPassword.value.trim();
    if (!username || !password) {
      authMsg.textContent = 'Enter username & password';
      return;
    }

    try {
      const { data: existing, error: checkError } = await supabase.from('users').select().eq('username', username);
      if (checkError) return logError('Error checking username', checkError);
      if (existing.length) return logError('Username already taken');

      const { data, error } = await supabase.from('users').insert([{ username, password, status:'online' }]).select();
      if (error) return logError('Error inserting user', error);

      console.log("User signed up:", data[0]);
      authMsg.textContent = 'Sign Up successful!';
    } catch (err) {
      logError('Unexpected error', err);
    }
  });

  loginBtn.addEventListener('click', async () => {
    console.log("Login clicked");
    const username = regUsername.value.trim();
    const password = regPassword.value.trim();
    if (!username || !password) {
      authMsg.textContent = 'Enter username & password';
      return;
    }

    try {
      const { data, error } = await supabase.from('users').select('*').eq('username', username).eq('password', password);
      if (error) return logError('Error querying user', error);
      if (!data.length) return logError('Invalid username/password');

      console.log("User logged in:", data[0]);
      authMsg.textContent = 'Login successful!';
    } catch (err) {
      logError('Unexpected error', err);
    }
  });
});
</script>
</body>
</html>
